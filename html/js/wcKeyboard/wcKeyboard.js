/**
 * @title	数字输入法键盘插件（仿微信支付、支付宝支付数字键盘）
 * @Create	andy
 * @Timer	2018/11/30 10:30:45 GMT+0800 (中国标准时间)
 * @bolg	https://www.cnblogs.com/xiaoyan2017   Q：282310962  wx：xy190310
 */

!function(e){var g=e.document,d=g.documentElement,c=0,a={$:function(h){return g.getElementById(h)},touch:function(j,i,h){j.addEventListener(i||"click",function(k){h.call(this,k)},!1)},jspath:function(){for(var j=g.getElementsByTagName("script"),h=j.length;h>0;h--){if(j[h-1].src&&j[h-1].src.match(/wcKeyboard[\w\-\.]*\.js/)!=null){return j[h-1].src.substring(0,j[h-1].src.lastIndexOf("/")+1)}}},extend:function(k,j){for(var h in j){if(!(h in k)){k[h]=j[h]}}return k},timer:{},show:{},end:{},},f=function(i){var j=this,h={debug:false,id:"wcKeyboard",selector:"",type:"",len:6,complete:null,max:"",style:"",skin:"wechat",ok:null,oninput:null,shade:true,shadeClose:true,opacity:"",anim:"",zIndex:9999,};j.opts=a.extend(i,h);j.init();document.activeElement.blur()};f.prototype={init:function(){var k=this,j=k.opts,h=null,i=function(){if(!j.type||j.type!="pwd"){return}if(j.type=="pwd"){j.debug=false}var m="";for(var l=0;l<j.len;l++){m+='<label class="kb-pwdlbl"><input type="password" maxlength="1" readonly /></label>'}return m}();createTpl=function(){var l="";if(j.skin&&j.skin=="wechat"){l+=['<ul>							<li class="kb-limit nbor"></li>',j.type&&j.type=="pwd"?('<li class="kb-pwd nbor"><div class="keyboard__panel-pwd">'+i+"</div></li>"):"",'<li class="kb-result nbor" style="display:'+(j.debug?"block":"none")+';"></li>							<li class="kb-xclose nbor"></li>							<li class="kb-number nbor">1</li>							<li class="kb-number">2</li>							<li class="kb-number">3</li>							<li class="kb-number nbor">4</li>							<li class="kb-number">5</li>							<li class="kb-number">6</li>							<li class="kb-number nbor">7</li>							<li class="kb-number">8</li>							<li class="kb-number">9</li>							<li class="kb-float nbor '+((j.type=="tel"||j.type=="pwd")?"disabled":"")+'">.</li>							<li class="kb-zero">0</li>							<li class="kb-del">×</li>						</ul>'].join("")}else{l+=['<ul class="clearfix">							<li class="kb-limit nbor"></li>',j.type&&j.type=="pwd"?('<li class="kb-pwd nbor"><div class="keyboard__panel-pwd">'+i+"</div></li>"):"",'<li class="kb-result nbor" style="display:'+(j.debug?"block":"none")+';"></li>							<div class="kb-flexbox flexbox">								<div class="kb-one flex1">									<li class="kb-number nbor">1</li>									<li class="kb-number">2</li>									<li class="kb-number">3</li>									<li class="kb-number nbor">4</li>									<li class="kb-number">5</li>									<li class="kb-number">6</li>									<li class="kb-number nbor">7</li>									<li class="kb-number">8</li>									<li class="kb-number">9</li>									<li class="kb-float nbor '+((j.type=="tel"||j.type=="pwd")?"disabled":"")+'">.</li>									<li class="kb-zero">0</li>									<li class="kb-xclose"></li>								</div>								<div class="kb-two">									<li class="kb-del"></li>									<li class="kb-sure">确定</li>								</div>							</div>						</ul>'].join("")}return l}();a.$(j.id)?(h=a.$(j.id)):(h=g.createElement("div"),h.id=j.id);h.setAttribute("index",c);h.setAttribute("class","wcKeyboard wcKeyboard"+c);h.innerHTML=['<div class="keyboard__ui-panel">',j.shade?('<div class="keyboard__ui-mask" style="'+(j.opacity!=null?"opacity:"+j.opacity:"")+"; z-index:"+(k.maxIndex()+1)+'"></div>'):"",'<div class="keyboard__panel-main '+(j.anim?"anim-"+j.anim:"")+" "+(j.skin?"keyboard__"+j.skin:"")+'" style="z-index:'+(k.maxIndex()+2)+"; "+j.style+'">						<div class="keyboard__panel-template">'+createTpl+"</div>					</div>				</div>"].join("");g.body.appendChild(h);g.getElementsByTagName("body")[0].classList.add("popui__overflow");j.show&&j.show.call(this);this.index=c++;k.callback()},callback:function(){var t=this,k=t.opts,u=a.$(k.id);var q=u.getElementsByClassName("kb-result")[0];function z(i,A){var o=u.getElementsByClassName("kb-limit")[0];o.classList.add(i);o.innerHTML=A;setTimeout(function(){o.classList.remove(i);o.innerHTML=""},2500)}function w(B){if(B.indexOf(".")!=-1&&B.substring(B.indexOf(".")+1,B.length).length==3){return}if(B=="0"){return}if(k.max){if(parseInt(B)>=k.max&&B.indexOf(".")==-1){z("error","最大限制值："+k.max.toFixed(2));return}}if(k.type&&k.type=="tel"){var o=B,i=parseInt(o.length),A=/^0?1[3|4|5|8|7][0-9]\d{8}$/;if(i>11){return}if(i==11){if(!A.test(o)){z("error","手机号码格式有误！")}else{z("success","验证通过！")}typeof k.complete=="function"&&k.complete.call(this,B)}}if(k.type&&k.type=="pwd"){var i=parseInt(B.length);if(i>k.len){return}if(i==k.len){typeof k.complete=="function"&&k.complete.call(this,B)}}return true}function r(E){if(!k.selector){return}var o=g.querySelector(k.selector);if(!o){return}if(k.type&&k.type=="pwd"){var A=u.getElementsByClassName("kb-pwd")[0],D=A.getElementsByTagName("input"),C=o.children;for(var B=0;B<k.len;B++){D[B].value=E[B]?E[B]:"";C.length&&(C[B].value=C[B].innerHTML=E[B]?E[B]:"")}}else{o.value=o.innerHTML=E}typeof k.oninput=="function"&&k.oninput.call(this,E)}for(var l=u.getElementsByClassName("kb-number"),s=l.length,n=0;n<s;n++){a.touch(l[n],"click",function(i){var o=q.innerHTML+this.innerHTML;if(!w(o)){return}q.innerHTML=o;r(q.innerHTML)
})}var p=u.getElementsByClassName("kb-float")[0];a.touch(p,"click",function(){var i=q.innerHTML;if(i==""||i.indexOf(".")!=-1){return}q.innerHTML=q.innerHTML+this.innerHTML;r(q.innerHTML)});var m=u.getElementsByClassName("kb-zero")[0];a.touch(m,"click",function(){var i=q.innerHTML+this.innerHTML;if(!w(i)){return}q.innerHTML=i;r(q.innerHTML)});var j=u.getElementsByClassName("kb-del")[0];a.touch(j,"click",function(){q.innerHTML=q.innerHTML.substring(0,q.innerHTML.length-1);r(q.innerHTML)});var h=u.getElementsByClassName("kb-sure")[0];h&&a.touch(h,"click",function(){var i=q.innerHTML;typeof k.ok=="function"&&k.ok.call(this,i)});if(k.shade&&k.shadeClose){var y=u.getElementsByClassName("keyboard__ui-mask")[0];a.touch(y,"click",function(){b.close(t.index)})}var x=u.getElementsByClassName("kb-xclose")[0];x&&a.touch(x,"click",function(){b.close(t.index)});var v=u.getElementsByClassName("keyboard__ui-panel")[0];v&&a.touch(v,"contextmenu",function(i){i.preventDefault()});k.end&&(a.end[t.index]=k.end)},maxIndex:function(){for(var j=this.opts.zIndex,l=g.getElementsByTagName("*"),k=0,h=l.length;k<h;k++){j=Math.max(j,l[k].style.zIndex)}return j}};var b=(function(){fn=function(h){var i=new f(h);return i.index};fn.close=function(h){var h=h||"";var i=g.getElementsByClassName("wcKeyboard"+h)[0];if(i){i.setAttribute("class","wcKeyboard-close");setTimeout(function(){g.body.removeChild(i);typeof a.end[h||0]=="function"&&a.end[h||0].call(this,h||0);delete a.end[h||0]},200);g.getElementsByTagName("body")[0].classList.remove("popui__overflow")}};fn.closeAll=function(){for(var k=g.getElementsByClassName(["wcKeyboard"]),j=0,h=k.length;j<h;j++){fn.close(0|k[0].getAttribute("index"))}};fn.load=function(k){for(var h=g.createElement("link"),l=g.getElementsByTagName("link"),j=l.length;j>0;j--){if(l[j-1].href==k){return}}h.type="text/css";h.rel="stylesheet";h.href=a.jspath()+k;g.getElementsByTagName("head")[0].appendChild(h)};return fn}());b.load("skin/wcKeyboard.css");e.wcKeyboard=b}(window);